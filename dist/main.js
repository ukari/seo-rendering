"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var http=_interopDefault(require("http")),fetch=_interopDefault(require("node-fetch")),weblog=_interopDefault(require("webpack-log")),path=_interopDefault(require("path")),program=_interopDefault(require("commander"));function __async(e){return new Promise(function(r,t){function o(i,s){try{var p=e[s?"throw":"next"](i)}catch(e){return void t(e)}p.done?r(p.value):Promise.resolve(p.value).then(o,n)}function n(e){o(e,1)}o()})}let{name:name,version:version}=require("../package.json");const logger=weblog({name:name});let reject_service=e=>{e.writeHead(403,{Reason:"This server only serve the seo-rendering proxy service"}),e.end()},proxy=({proxyUrl:e,targetUrl:r})=>http.createServer((t,o)=>__async(function*(){if("GET"===t.method){yield fetch(e+"/"+r+t.url,{headers:{"User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/71.0.3578.98 Chrome/71.0.3578.98 Safari/537.36"}}),yield result.text();return o.writeHead(200,{}),void o.end(result)}reject_service(o)}())),launch=({proxyUrl:e,targetUrl:r,port:t,host:o})=>proxy({proxyUrl:e,targetUrl:r}).listen(t,o,()=>{logger.info(`seo-rendering proxy launch on ${o}:${t}`),logger.info(`GET request will be redirect to ${e}/${r}`)}),options={host:"127.0.0.1",port:"8081"},setOpt=e=>r=>options[e]=r;program.name(name).version(version,"-v, --version").option("-S, --service [proxyUrl]","the headless proxy service url",setOpt("proxyUrl")).option("-T, --target [targetUrl]","the target website url",setOpt("targetUrl")).option("-H, --host [host]","hostname of this proxy server",setOpt("host")).option("-P, --port [port]","port number of this proxy server",setOpt("port")).option("-C, --config [json filename]","run with config json file",e=>{let r=require(path.join(process.cwd(),e));options=r}).parse(process.argv),launch(options);
